"use strict";function e(n,o){var u,m,l,h,p,g=n,v=o||{};return n&&"object"==typeof n&&(g=(v=n).format||"default",a("morgan(options): use morgan("+("string"==typeof g?JSON.stringify(g):"format")+", options) instead")),void 0===g&&a("undefined format: specify a format"),u=v.immediate,m=v.skip||!1,l="function"!=typeof g?function(){var r=e[g]||g||e.default;return"function"!=typeof r?t(r):r}():g,h=v.buffer,p=v.stream||process.stdout,h&&(a("buffer option"),p=function(e,t){function r(){o=null,e.write(n.join("")),n.length=0}var n=[],o=null;return{write:function(e){null===o&&(o=setTimeout(r,t)),n.push(e)}}}(p,"number"!=typeof h?c:h)),function(t,n,o){function a(){if(!1!==m&&m(t,n))i("skip request");else{var r=l(e,t,n);null!=r?(i("log request"),p.write(r+"\n")):i("skip line")}}t._startAt=void 0,t._startTime=void 0,t._remoteAddress=r(t),n._startAt=void 0,n._startTime=void 0,s.call(t),u?a():(d(n,s),f(n,a)),o()}}function t(e){var t,r;if("string"!=typeof e)throw new TypeError("argument format must be a string");return t=e.replace(/"/g,'\\"'),r='  "use strict"\n  return "'+t.replace(/:([-\w]{2,})(?:\[([^\]]+)\])?/g,function(e,t,r){var n="req, res",o="tokens["+JSON.stringify(t)+"]";return void 0!==r&&(n+=", "+JSON.stringify(r)),'" +\n    ('+o+"("+n+') || "-") + "'})+'"',Function("tokens, req, res",r)}function r(e){return e.ip||e._remoteAddress||e.connection&&e.connection.remoteAddress||void 0}function n(e){return"boolean"!=typeof e.headersSent?!!e._header:e.headersSent}function o(e){var t=e+"";return(1===t.length?"0":"")+t}function s(){this._startAt=process.hrtime(),this._startTime=new Date}var u,i,a,f,d,m,c;module.exports=e,module.exports.compile=t,module.exports.format=function(t,r){return e[t]=r,this},module.exports.token=function(t,r){return e[t]=r,this},u=require("basic-auth"),i=require("debug")("morgan"),a=require("depd")("morgan"),f=require("on-finished"),d=require("on-headers"),m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=1e3,e.format("combined",':remote-addr - :remote-user [:date[clf]] ":method :url HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent"'),e.format("common",':remote-addr - :remote-user [:date[clf]] ":method :url HTTP/:http-version" :status :res[content-length]'),e.format("default",':remote-addr - :remote-user [:date] ":method :url HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent"'),a.property(e,"default","default format: use combined format"),e.format("short",":remote-addr :remote-user :method :url HTTP/:http-version :status :res[content-length] - :response-time ms"),e.format("tiny",":method :url :status :res[content-length] - :response-time ms"),e.format("dev",function e(r,o,s){var u=n(s)?s.statusCode:void 0,i=u>=500?31:u>=400?33:u>=300?36:u>=200?32:0,a=e[i];return a||(a=e[i]=t("[0m:method :url ["+i+"m:status [0m:response-time ms - :res[content-length][0m")),a(r,o,s)}),e.token("url",function(e){return e.originalUrl||e.url}),e.token("method",function(e){return e.method}),e.token("response-time",function(e,t,r){if(e._startAt&&t._startAt)return(1e3*(t._startAt[0]-e._startAt[0])+1e-6*(t._startAt[1]-e._startAt[1])).toFixed(void 0===r?3:r)}),e.token("date",function(e,t,r){var n=new Date;switch(r||"web"){case"clf":return function(e){var t=e.getUTCDate(),r=e.getUTCHours(),n=e.getUTCMinutes(),s=e.getUTCSeconds(),u=e.getUTCFullYear(),i=m[e.getUTCMonth()];return o(t)+"/"+i+"/"+u+":"+o(r)+":"+o(n)+":"+o(s)+" +0000"}(n);case"iso":return n.toISOString();case"web":return n.toUTCString()}}),e.token("status",function(e,t){return n(t)?t.statusCode+"":void 0}),e.token("referrer",function(e){return e.headers.referer||e.headers.referrer}),e.token("remote-addr",r),e.token("remote-user",function(e){var t=u(e);return t?t.name:void 0}),e.token("http-version",function(e){return e.httpVersionMajor+"."+e.httpVersionMinor}),e.token("user-agent",function(e){return e.headers["user-agent"]}),e.token("req",function(e,t,r){var n=e.headers[r.toLowerCase()];return Array.isArray(n)?n.join(", "):n}),e.token("res",function(e,t,r){if(n(t)){var o=t.getHeader(r);return Array.isArray(o)?o.join(", "):o}});