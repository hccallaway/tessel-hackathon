"use strict";function e(e){var n=e.socket;return"boolean"==typeof e.finished?!!(e.finished||n&&!n.writable):"boolean"==typeof e.complete?!(!e.upgrade&&n&&n.readable&&(!e.complete||e.readable)):void 0}var n,o;module.exports=function(i,t){return!1!==e(i)?(o(t,null,i),i):(function(e,o){var i=e.__onFinished;i&&i.queue||(i=e.__onFinished=function(e){function n(o){var i,t;if(e.__onFinished===n&&(e.__onFinished=null),n.queue)for(i=n.queue,n.queue=null,t=0;t<i.length;t++)i[t](o,e)}return n.queue=[],n}(e),function(e,o){function i(e){s.cancel(),u.cancel(),c=!0,o(e)}function t(o){e.removeListener("socket",t),c||s===u&&(u=n([[o,"error","close"]],i))}var u,c=!1,s=u=n([[e,"end","finish"]],i);e.socket?t(e.socket):(e.on("socket",t),void 0===e.socket&&function(e,n){var o=e.assignSocket;"function"==typeof o&&(e.assignSocket=function(e){o.call(this,e),n(e)})}(e,t))}(e,i)),i.queue.push(o)}(i,t),i)},module.exports.isFinished=e,n=require("ee-first"),o="function"==typeof setImmediate?setImmediate:function(e){process.nextTick(e.bind.apply(e,arguments))};